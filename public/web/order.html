<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>我的优惠券</title>
    <link rel="stylesheet" href="asset/css/app.css">
    <link rel="stylesheet" href="../layui/css/layui.css">
</head>
<body>
<div class="overview">
    <div class="layui-card">
        <div class="layui-card-header">消费记录</div>
        <div class="layui-card-body">
            <ul class="layui-timeline order_block">
            </ul>
        </div>
    </div>
</div>
<div class="layui-hide order_line_html">
    <li class="layui-timeline-item order_line">
        <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
        <div class="layui-timeline-content layui-text">
            <h3 class="layui-timeline-title">8月18日</h3>
            <p class="number">
                <i class="layui-icon">&#xe66e;</i>
                <span>[NUMBER]</span>
            </p>
            <p class="price">
                <i class="layui-icon">&#xe65e;</i>
                <span>[PRICE]</span>
            </p>
            <p class="status">
                <span>[STATUS]</span>
            </p>
        </div>
    </li>
</div>
<div class="layui-hide nothing_html">
    <div class="nothing">
        <div class="icon">
            <i class="">!</i>
        </div>
        <div class="text">
            [TEXT]
        </div>
    </div>
</div>
<script src="../layui/layui.js"></script>
<script src="asset/js/app.js"></script>
<script>
    layui.use(['layer','jquery'], function(){
        let jq = layui.jquery;
        let layer = layui.layer;

        let nothing_html = jq('.nothing_html').html();
        let order_line_html = jq('.order_line_html').html();
        jq.ajax({
            url : '/api/order/getToMember',
            data :{},
            dataType:'json',
            type:'post',
            beforeSend(){
                layer.open({type:3});
            },
            success(res)
            {
                let html = '';
                if(res.status == 0)
                {
                    html = nothing_html.replace('[TEXT]',res.msg)
                }
                if(res.status == 1)
                {
                    let dt = res.data;
                    for(let i in dt)
                    {
                        let status = [
                            '',
                            '<span class="layui-badge">'+dt[i].status_text+'</span>',
                            '<span class="layui-badge layui-bg-green">'+dt[i].status_text+'</span>'
                        ];
                        html += order_line_html.replace('[NUMBER]',dt[i].order_id).replace('[PRICE]',dt[i].current_point).replace('[STATUS]',status[dt[i].status]);
                    }
                }

                jq('.order_block').html(html);
                layer.closeAll();
            }
        });
    });
</script>
</body>
</html>