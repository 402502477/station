<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>账户余额</title>
    <link rel="stylesheet" href="asset/css/app.css">
    <link rel="stylesheet" href="../layui/css/layui.css">
</head>
<body>
<div class="overview">
    <div class="layui-row layui-bg-cyan">
        <div class="member-body layui-clear">
            <div class="layui-col-xs3">
                <div class="avatar"><img class="layui-circle" src="" alt="">
                </div>
            </div>
            <div class="layui-col-xs9">
                <div class="username"><span></span></div>
            </div>
        </div>
    </div>
    <fieldset class="layui-elem-field layui-field-title text-block recharge">
        <legend>基本信息</legend>
        <div class="layui-field-box">
            <div class="text-line layui-clear">
                <span class="left">余额</span>
                <span class="right balance"></span>
            </div>
        </div>
        <form class="layui-form" action="">
            <div class="layui-field-box">
                <div class="text-line layui-clear">
                    <span class="left">请输入充值金额</span>
                    <span class="right">
                        <input type="number" class="input" lay-verify="limit">
                        <i class="layui-icon">&#xe642;</i>
                    </span>

                    <div class="button">
                        <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="*">充值</button>
                    </div>
                </div>
            </div>
        </form>
    </fieldset>
    <fieldset class="layui-elem-field layui-field-title text-block">
        <legend>充值说明</legend>
        <div class="layui-field-box">
            <div class="text-line layui-clear promotion_info">
                <span></span>
            </div>
        </div>
    </fieldset>
</div>

<script src="../layui/layui.js"></script>
<script>
    layui.use(['form','jquery','layer'], function(){
        let jq = layui.jquery;
        let mask = '';
        let limit = 0;
        let form = layui.form;

        jq.ajax({
            url: '/api/member/find',
            data : {
                //TODO 增加uid
            },
            type : 'post',
            dataType : 'json',
            beforeSend(){
                mask =layer.open({
                    type: 3
                });
            },
            success(r)
            {
                if(r.status == 2)
                {
                    layer.open({
                        title: '提示',
                        content: r.msg
                    });
                    return null;
                }
                let data = r.data;
                jq('.avatar img').attr('src',data.info.headimgurl);
                jq('.username span').text(data.username);
                jq('.balance').text(data.balance);
                layer.close(mask);
            }
        });
        jq.ajax({
            url: '/api/setting/get',
            type : 'post',
            dataType : 'json',
            beforeSend(){
                layer.open({
                    type: 3
                });
            },
            success(r)
            {
                let able = false;
                if(r)
                {
                    if(r.balance) able = r.balance.switch || false;
                }
                if(able == false)
                {
                    layer.open({
                        content : '系统未开启余额储值功能，请联系管理员'
                    });
                    return null;
                }

                let info = r.balance;
                limit = info.limit;
                let promotion_info = '充值即可享受' + info.point + info.type + '优惠,最低充值' + info.limit + '元';
                jq('.promotion_info span').text(promotion_info);
                layer.closeAll();
            }
        });
        form.verify({
            limit(value)
            {
                if(value < limit)
                {
                    return '请充值大于'+limit+'金额！';
                }
            }
        });
        form.on('submit(*)',function(data){
            let fields = data.field;
            return false;
        });

    });
</script>
</body>
</html>